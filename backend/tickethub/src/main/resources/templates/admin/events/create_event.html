<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    {{#event}}Editar Evento{{/event}}
    {{^event}}Crear Evento{{/event}}
  </title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- TU CSS PERSONALIZADO -->
  <link rel="stylesheet" href="/css/main.css">
</head>
<body class="d-flex flex-column min-vh-100">

  <!--LOCATION OF THE HEADER OF THE WEB-->

  {{>components/header_admin}}

  <div class="container my-5">
    <h2>
      {{#event}}Editar Evento{{/event}}
      {{^event}}Crear Evento{{/event}}
    </h2>
    <form method="post" enctype="multipart/form-data" action="/admin/events/{{#event}}edit_event/{{eventID}}{{/event}}{{^eventID}}create_event{{/eventID}}">

      {{#event}}
        <input type="hidden" name="eventID" value="{{eventID}}">
      {{/event}}

      <p class="fw-bold mb-1">Nombre del evento</p>
      {{#event}}
        <input name="name" class="form-control mb-3" value="{{event.name}}" required>
      {{/event}}
      {{^event}}
        <input name="name" class="form-control mb-3" required>
      {{/event}}

      <p class="fw-bold mb-1">Capacidad total</p>
      {{#event}}
        <input name="capacity" type="number" class="form-control mb-3" value="{{event.capacity}}">
      {{/event}}
      {{^event}}
        <input name="capacity" type="number" class="form-control mb-3">
      {{/event}}

      <p class="fw-bold mb-1">Categoría</p>
      {{#event}}
        <input name="category" type="text" class="form-control mb-3" value="{{event.category}}">
      {{/event}}
      {{^event}}
        <input name="category" type="text" class="form-control mb-3">
      {{/event}}

      <p class="fw-bold mb-1">Lugar</p>
      {{#event}}
        <input name="place" type="text" class="form-control mb-3" value="{{event.place}}">
      {{/event}}
      {{^event}}
        <input name="place" type="text" class="form-control mb-3">
      {{/event}}

      <!--NO HE CONSEGUIDO ARREGLAR EL FALLO AL EDITAR, EL ERROR QUE DA ES QUE AL DARLE A GUARDAR CAMBIOS NO PILLA EL ARTISTA Y EL INPUT SE ELIMINA
          SI LO CONSIGUES ARREGLAR FUNCIONARÍA BIEN EL EDITAR EVENT-->
      <p class="fw-bold mb-1">Artista principal</p>
        <select name="artistID" class="form-select" required>
          {{#event}}
            <option value="{{artist.artistID}}">{{artist.artistName}}</option>
          {{/event}}
          {{^event}}
            <option selected>Selecciona un artista</option>
          {{/event}}

          {{#allArtists}}
            <option value="{{artistID}}" {{#isSelected}}selected{{/isSelected}}>{{artistName}}</option>
          {{/allArtists}}
        </select>

      <p class="fw-bold mb-1">Edad objetivo</p>
      <select name="targetAge" class="form-select mb-3">
        <option value="0" {{#event.targetAge0}}selected{{/event.targetAge0}}>Niños pequeños</option>
        <option value="1" {{#event.targetAge1}}selected{{/event.targetAge1}}>Niños</option>
        <option value="2" {{#event.targetAge2}}selected{{/event.targetAge2}}>Adolescentes</option>
        <option value="3" {{#event.targetAge3}}selected{{/event.targetAge3}}>Adultos jóvenes</option>
        <option value="4" {{#event.targetAge4}}selected{{/event.targetAge4}}>Adultos</option>
        <option value="5" {{#event.targetAge5}}selected{{/event.targetAge5}}>Adultos sénior</option>
        <option value="6" {{#event.targetAge6}}selected{{/event.targetAge6}}>Ancianos</option>
      </select>

      <p class="fw-bold mb-1">Sesiones</p>
      {{#event}}
        <a href="/admin/events/{{eventID}}/manage_sessions" class="btn btn-info mb-3">
          Gestionar Sesiones
        </a>
      {{/event}}

      {{^event}}
        <div class="mb-3">
          <label class="form-label">Primero guarda el evento para gestionar sesiones</label>
        </div>
      {{/event}}

      <!--Aquí y debajo en los descuentos deben de aparecer en el desplegable las zonas y descuentos asociadas al evento (en sus listas)
          Ahora mismo no aparecen porque las listas están vacías, para comprobar que aparecen correctamente tienes que añadirlas en el
          dataBaseInitializer (donde el método de initialize events, que igual tienes que cambiar el orden de cómo se guardan las cosas
          en el método de abajo del todo (initializeDatabase) para poderle pasar las zonas y descuentos que quieras al método) en el evento que quieras
      -->
      <p class="fw-bold mb-1">Zonas presentes</p>
      <div id="zones-container">
        {{#event.zones}}
        <div class="row g-2 mb-2 discount-row align-items-center">
          <div class="col">
            <select name="zones" class="form-select">
              {{#allZones}}
                <option value="{{id}}" {{#selected}}selected{{/selected}}>{{name}}</option>
              {{/allZones}}
            </select>
          </div>
          <div class="col-auto">
            <button type="button" class="btn btn-danger btn-sm remove-zone">Eliminar</button>
          </div>
        </div>
        {{/event.zones}}

        {{^event.zones}}
        <div class="row g-2 mb-2 discount-row align-items-center">
          <div class="col">
            <select name="zones" class="form-select">
              {{#allZones}}
                <option value="{{id}}">{{name}}</option>
              {{/allZones}}
            </select>
          </div>
          <div class="col-auto">
            <button type="button" class="btn btn-danger btn-sm remove-zone">Eliminar</button>
          </div>
        </div>
        {{/event.zones}}
      </div>
      <button type="button" class="btn btn-primary mb-3" id="add-zone">Agregar zona</button>

      <p class="fw-bold mb-1">Descuentos asociados</p>
      <div id="discounts-container">
        {{#event.discounts}}
        <div class="row g-2 mb-2 discount-row align-items-center">
          <div class="col">
            <select name="discounts" class="form-select">
              {{#allDiscounts}}
                <option value="{{id}}" {{#selected}}selected{{/selected}}>{{discountName}}</option>
              {{/allDiscounts}}
            </select>
          </div>
          <div class="col-auto">
            <button type="button" class="btn btn-danger btn-sm remove-discount">Eliminar</button>
          </div>
        </div>
        {{/event.discounts}}

        {{^event.discounts}}
        <div class="row g-2 mb-2 discount-row align-items-center">
          <div class="col">
            <select name="discounts" class="form-select">
              {{#allDiscounts}}
                <option value="{{id}}">{{discountName}}</option>
              {{/allDiscounts}}
            </select>
          </div>
          <div class="col-auto">
            <button type="button" class="btn btn-danger btn-sm remove-discount">Eliminar</button>
          </div>
        </div>
        {{/event.discounts}}
      </div>
      <button type="button" class="btn btn-primary mb-3" id="add-discount">Agregar descuento</button>

      <p class="fw-bold mb-1">Imágenes</p>
      <input type="file" name="images" class="form-control mb-3" multiple>

      <div class="d-flex justify-content-between mt-3">
        <a href="/admin/events/manage_events" class="btn btn-secondary">Cancelar</a>

        <button type="submit" class="btn btn-success">
          {{#event}}Guardar cambios{{/event}}
          {{^event}}Crear evento{{/event}}
        </button>

      </div>

    </form>
  </div>

  <script src="/js/eventThings.js"></script>

  <!--LOCATION OF THE FOOTER OF THE WEB-->

  {{>components/footer_admin}}
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
